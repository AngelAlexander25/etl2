name: Scraper Semanal de Propiedades

on:
  schedule:
    # Ejecutar cada domingo a las 2 AM (UTC)
    - cron: '0 2 * * 0'
  workflow_dispatch: # Permite ejecución manual desde GitHub

jobs:
  scrape:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout código
      uses: actions/checkout@v3
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Instalar dependencias
      run: |
        pip install selenium psycopg2-binary python-dotenv webdriver-manager pandas
        
    - name: Ejecutar scraper
      env:
        DB_HOST: ${{ secrets.DB_HOST }}
        DB_PORT: ${{ secrets.DB_PORT }}
        DB_USER: ${{ secrets.DB_USER }}
        DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
        DB_NAME: ${{ secrets.DB_NAME }}
      run: |
        python scraper_selenium.py
        python generate_real_data.py
        python database.py
    
    - name: Notificar éxito
      if: success()
      run: echo "✅ Scraper ejecutado exitosamente"
